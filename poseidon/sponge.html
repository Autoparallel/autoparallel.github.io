<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sponge - Poseidon Journal</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../overview/index.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../overview/curriculum.html"><strong aria-hidden="true">1.1.</strong> Curriculum</a></li><li class="chapter-item expanded "><a href="../overview/motivation.html"><strong aria-hidden="true">1.2.</strong> motivation</a></li></ol></li><li class="chapter-item expanded "><a href="../poseidon/index.html"><strong aria-hidden="true">2.</strong> Poseidon</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../poseidon/construction.html"><strong aria-hidden="true">2.1.</strong> Construction</a></li><li class="chapter-item expanded "><a href="../poseidon/scalar_field.html"><strong aria-hidden="true">2.2.</strong> Scalar Field</a></li><li class="chapter-item expanded "><a href="../poseidon/sponge.html" class="active"><strong aria-hidden="true">2.3.</strong> Sponge</a></li><li class="chapter-item expanded "><a href="../poseidon/permutation.html"><strong aria-hidden="true">2.4.</strong> Permutation</a></li><li class="chapter-item expanded "><a href="../poseidon/s-boxes.html"><strong aria-hidden="true">2.5.</strong> S-Boxes</a></li><li class="chapter-item expanded "><a href="../poseidon/linear_layer.html"><strong aria-hidden="true">2.6.</strong> Linear Layer</a></li><li class="chapter-item expanded "><a href="../poseidon/round_constants.html"><strong aria-hidden="true">2.7.</strong> Round Constants</a></li></ol></li><li class="chapter-item expanded "><a href="../security/index.html"><strong aria-hidden="true">3.</strong> Security</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../security/linear_cryptanalysis.html"><strong aria-hidden="true">3.1.</strong> Linear Cryptanalysis</a></li><li class="chapter-item expanded "><a href="../security/differential_cryptanalysis.html"><strong aria-hidden="true">3.2.</strong> Differential Cryptanalysis</a></li><li class="chapter-item expanded "><a href="../security/algebraic_cryptanalysis.html"><strong aria-hidden="true">3.3.</strong> Algebraic Cryptanalysis</a></li><li class="chapter-item expanded "><a href="../security/new_thoughts.html"><strong aria-hidden="true">3.4.</strong> New Ideas for attacks</a></li></ol></li><li class="chapter-item expanded "><a href="../resources/index.html"><strong aria-hidden="true">4.</strong> Resources</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../resources/blogs_and_code.html"><strong aria-hidden="true">4.1.</strong> Blogs and Code</a></li><li class="chapter-item expanded "><a href="../resources/videos_talks.html"><strong aria-hidden="true">4.2.</strong> Videos and talks</a></li><li class="chapter-item expanded "><a href="../resources/people_courses.html"><strong aria-hidden="true">4.3.</strong> People and courses</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Poseidon Journal</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="sponge"><a class="header" href="#sponge">Sponge</a></h1>
<p>Sponges are used in cryptography to absorb data of any size and produce a fixed-size output. 
They are used in hash functions, pseudo-random number generators, stream ciphers, and authenticated encryption schemes.
More can be found at this <a href="https://en.wikipedia.org/wiki/Sponge_function">link</a>.</p>
<h2 id="why-we-call-it-a-sponge"><a class="header" href="#why-we-call-it-a-sponge">Why we call it a sponge</a></h2>
<p><strong>The Sponge (State) Idea:</strong>
Think of the sponge as having two action: it first absorbs input data like a sponge absorbs liquid, and subsequently this data gets squeezed to produce output data like a sponge releases liquid. 
In cryptographic terms, this sponge is the internal <strong>state</strong> of the hash function.</p>
<ol>
<li>
<p><strong>Absorbing Phase:</strong></p>
<ul>
<li>Data such as a message, a file, or a number is divided into blocks, for instance, of a given number of bits or the size of a finite field.</li>
<li>Each block of your input data is &quot;absorbed&quot; into the sponge where it is then mixed with the residual data (like the residual &quot;liquid&quot;) in the sponge. 
The absorption and mixing process are defined concretely by the rate and capacity of the sponge respectively.
This mixing process can be thought of like absorbing some new blue colored water into one chunk of the sponge and some new red in another while there is already some green soaking in the rest of the sponge. 
Fitting to the analogy, to truly mix these, the sponge would be allowed to sit where diffusion of the colors would occur.
In the cryptographic case, we use a permutation to mix the data like diffusion can mix the colors.</li>
</ul>
</li>
<li>
<p><strong>Squeezing Phase:</strong></p>
<ul>
<li>Once the sponge has absorbed all your data (or all the colored water in the analogy), it's time to get the hash output, similar to squeezing water out of the sponge.</li>
<li>In the squeezing phase, part of the sponge's state is read out as the hash result. 
If the desired hash output is longer, the sponge might be &quot;squeezed&quot; multiple times, with additional transformations in between to ensure security.
If it is shorter, the sponge is squeezed only once, and the output is truncated to the desired length.
By squeezing the sponge, we are essentially wringing out the water, leaving us with a fixed amount of water (the hash) that is a mix of all the colors (the input data).
The blue, red, and green water in our analogy now becomes a single murky brownish purplish color, which is the hash output.
Could you ever get the original colors back from this let alone the order they were added in?</li>
</ul>
</li>
</ol>
<h3 id="why-are-sponges-convenient"><a class="header" href="#why-are-sponges-convenient">Why are sponges convenient?</a></h3>
<ol>
<li>
<p><strong>Flexibility with Input Sizes:</strong></p>
<ul>
<li>The sponge construction can handle input data of any size. 
It absorbs data block by block until all data is processed.</li>
</ul>
</li>
<li>
<p><strong>Fixed Output Size:</strong></p>
<ul>
<li>The hash function produces outputs of a fixed size, regardless of the input size.</li>
</ul>
</li>
<li>
<p><strong>Security:</strong></p>
<ul>
<li>The mixing and transformation processes in the sponge ensure that even a small change in the input (like adding a drop of differently colored water) leads to a completely different and unpredictable output, which is a crucial aspect of secure hash functions.</li>
</ul>
</li>
</ol>
<h2 id="sponge-construction"><a class="header" href="#sponge-construction">Sponge Construction</a></h2>
<p>The <a href="https://en.wikipedia.org/wiki/Sponge_function">Wikipedia: Sponge function article</a> breaks down the sponge nicely, but it does so for sponges that absorb bits rather than elements of a finite field.
From this reference and the <a href="https://eprint.iacr.org/2019/458.pdf">Poseidon paper</a>, we can outline the sponge used in Poseidon making the necessary changes in terminology and notation.</p>
<p>The sponge construction is defined by the following parameters:</p>
<ul>
<li>The size of the <em>chunks</em> which are the elements of the finite field <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.975em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathbb">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>;</li>
<li>The size of the state <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> which is the number of chunks in the sponge;
<ul>
<li>The rate <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span> which is the number of chunks absorbed in each step;</li>
<li>The capacity <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span> which is the number of chunks stored in the sponge in each step;</li>
<li>Note that at any given point in the process, we have <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span>.</li>
</ul>
</li>
<li>A function <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2244em;vertical-align:-0.3831em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace nobreak"></span><span class="mspace" style="margin-right:0.1111em;"></span><span class="mpunct"></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mrel">:</span></span><span class="mspace" style="margin-right:0.3333em;"></span><span class="mord"><span class="mord mathbb">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2244em;vertical-align:-0.3831em;"></span><span class="mord"><span class="mord mathbb">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span></span></span></span> which is the permutation applied to the sponge, which for Poseidon is a combination of S-Boxes and linear layers;
<ul>
<li>The rate can then be described via the <code>bits/perm</code> ratio which is the number of bits in the state divided by the number of bits in the permutation.</li>
</ul>
</li>
<li>A padding function <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> to pad the input to the sponge to a multiple of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span> chunks as needed.</li>
</ul>
<p>For Poseidon in particular, we will follow this flow:</p>
<ol>
<li>Determine the capacity element value and the input padding if needed. </li>
<li>Split the obtained input into chunks of size r. </li>
<li>Apply the permutation Poseidon permuation <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span> (our <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> above, essentially) to the capacity element and the first chunk. </li>
<li>Until no more chunks are left, add them into the state and apply the permutation. </li>
<li>Output <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">o</span></span></span></span> output elements out of the rate part of the state. If needed, iterate the permutation more times.</li>
</ol>
<p>Looking at this diagramatically, we have the following:
<img src="./figures/sponge.png" alt="Sponge Diagram" /></p>
<p>TODO: It seems like the chunks are actually of size <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span> not <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span> from the field. </p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../poseidon/scalar_field.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../poseidon/permutation.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../poseidon/scalar_field.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../poseidon/permutation.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
